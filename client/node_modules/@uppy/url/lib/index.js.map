{"version":3,"sources":["index.js"],"names":["UIPlugin","require","h","RequestClient","UrlUI","forEachDroppedOrPastedUrl","UrlIcon","module","exports","Url","constructor","uppy","opts","id","title","type","icon","defaultLocale","strings","import","enterUrlToImport","failedToFetch","enterCorrectUrl","defaultOptions","i18nInit","hostname","companionUrl","Error","getMeta","bind","addFile","handleRootDrop","handleRootPaste","client","companionHeaders","companionCookiesRule","getFileNameFromUrl","url","substring","lastIndexOf","checkIfCorrectURL","protocol","match","addProtocolToURL","protocolRegex","defaultProtocol","test","post","then","res","error","log","info","i18n","meta","tagFile","source","name","data","size","isRemote","body","remote","fileId","providerOptions","err","isRestriction","catch","message","details","e","dataTransfer","clipboardData","render","install","target","mount","uninstall","unmount","VERSION"],"mappings":"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","sourcesContent":["const { UIPlugin } = require('@uppy/core')\nconst { h } = require('preact')\nconst { RequestClient } = require('@uppy/companion-client')\nconst UrlUI = require('./UrlUI.js')\nconst forEachDroppedOrPastedUrl = require('./utils/forEachDroppedOrPastedUrl')\n\nfunction UrlIcon () {\n  return (\n    <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <rect className=\"uppy-ProviderIconBg\" fill=\"#FF753E\" width=\"32\" height=\"32\" rx=\"16\" />\n        <path d=\"M22.788 15.389l-2.199 2.19a3.184 3.184 0 0 1-.513.437c-.806.584-1.686.876-2.638.876a4.378 4.378 0 0 1-3.519-1.752c-.22-.292-.146-.802.147-1.021.293-.22.806-.146 1.026.146.953 1.313 2.785 1.532 4.105.583a.571.571 0 0 0 .293-.292l2.199-2.189c1.1-1.167 1.1-2.992-.073-4.086a2.976 2.976 0 0 0-4.105 0l-1.246 1.24a.71.71 0 0 1-1.026 0 .703.703 0 0 1 0-1.022l1.246-1.24a4.305 4.305 0 0 1 6.083 0c1.833 1.605 1.906 4.451.22 6.13zm-7.183 5.035l-1.246 1.24a2.976 2.976 0 0 1-4.105 0c-1.172-1.094-1.172-2.991-.073-4.086l2.2-2.19.292-.291c.66-.438 1.393-.657 2.2-.584.805.146 1.465.51 1.905 1.168.22.292.733.365 1.026.146.293-.22.367-.73.147-1.022-.733-.949-1.76-1.532-2.859-1.678-1.1-.22-2.272.073-3.225.802l-.44.438-2.199 2.19c-1.686 1.75-1.612 4.524.074 6.202.88.803 1.979 1.241 3.078 1.241 1.1 0 2.199-.438 3.079-1.24l1.246-1.241a.703.703 0 0 0 0-1.022c-.294-.292-.807-.365-1.1-.073z\" fill=\"#FFF\" fillRule=\"nonzero\" />\n      </g>\n    </svg>\n  )\n}\n\n/**\n * Url\n *\n */\nmodule.exports = class Url extends UIPlugin {\n  static VERSION = require('../package.json').version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Url'\n    this.title = this.opts.title || 'Link'\n    this.type = 'acquirer'\n    this.icon = () => <UrlIcon />\n\n    // Set default options and locale\n    this.defaultLocale = {\n      strings: {\n        import: 'Import',\n        enterUrlToImport: 'Enter URL to import a file',\n        failedToFetch: 'Companion failed to fetch this URL, please make sure itâ€™s correct',\n        enterCorrectUrl: 'Incorrect URL: Please make sure you are entering a direct link to a file',\n      },\n    }\n\n    const defaultOptions = {}\n\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.i18nInit()\n\n    this.hostname = this.opts.companionUrl\n\n    if (!this.hostname) {\n      throw new Error('Companion hostname is required, please consult https://uppy.io/docs/companion')\n    }\n\n    // Bind all event handlers for referencability\n    this.getMeta = this.getMeta.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.handleRootDrop = this.handleRootDrop.bind(this)\n    this.handleRootPaste = this.handleRootPaste.bind(this)\n\n    this.client = new RequestClient(uppy, {\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders,\n      companionCookiesRule: this.opts.companionCookiesRule,\n    })\n  }\n\n  getFileNameFromUrl (url) {\n    return url.substring(url.lastIndexOf('/') + 1)\n  }\n\n  checkIfCorrectURL (url) {\n    if (!url) return false\n\n    const protocol = url.match(/^([a-z0-9]+):\\/\\//)[1]\n    if (protocol !== 'http' && protocol !== 'https') {\n      return false\n    }\n\n    return true\n  }\n\n  addProtocolToURL (url) {\n    const protocolRegex = /^[a-z0-9]+:\\/\\//\n    const defaultProtocol = 'http://'\n    if (protocolRegex.test(url)) {\n      return url\n    }\n\n    return defaultProtocol + url\n  }\n\n  getMeta (url) {\n    return this.client.post('url/meta', { url })\n      .then((res) => {\n        if (res.error) {\n          this.uppy.log('[URL] Error:')\n          this.uppy.log(res.error)\n          throw new Error('Failed to fetch the file')\n        }\n        return res\n      })\n  }\n\n  addFile (url) {\n    url = this.addProtocolToURL(url)\n    if (!this.checkIfCorrectURL(url)) {\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\n      return\n    }\n\n    return this.getMeta(url)\n      .then((meta) => {\n        const tagFile = {\n          source: this.id,\n          name: this.getFileNameFromUrl(url),\n          type: meta.type,\n          data: {\n            size: meta.size,\n          },\n          isRemote: true,\n          body: {\n            url,\n          },\n          remote: {\n            companionUrl: this.opts.companionUrl,\n            url: `${this.hostname}/url/get`,\n            body: {\n              fileId: url,\n              url,\n            },\n            providerOptions: this.client.opts,\n          },\n        }\n        return tagFile\n      })\n      .then((tagFile) => {\n        this.uppy.log('[Url] Adding remote file')\n        try {\n          return this.uppy.addFile(tagFile)\n        } catch (err) {\n          if (!err.isRestriction) {\n            this.uppy.log(err)\n          }\n          return err\n        }\n      })\n      .catch((err) => {\n        this.uppy.log(err)\n        this.uppy.info({\n          message: this.i18n('failedToFetch'),\n          details: err,\n        }, 'error', 4000)\n        return err\n      })\n  }\n\n  handleRootDrop (e) {\n    forEachDroppedOrPastedUrl(e.dataTransfer, 'drop', (url) => {\n      this.uppy.log(`[URL] Adding file from dropped url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  handleRootPaste (e) {\n    forEachDroppedOrPastedUrl(e.clipboardData, 'paste', (url) => {\n      this.uppy.log(`[URL] Adding file from pasted url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  render () {\n    return <UrlUI i18n={this.i18n} addFile={this.addFile} />\n  }\n\n  install () {\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"]}