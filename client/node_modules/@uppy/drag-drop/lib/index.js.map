{"version":3,"sources":["index.js"],"names":["UIPlugin","require","toArray","isDragDropSupported","getDroppedFiles","h","module","exports","DragDrop","constructor","uppy","opts","type","id","title","defaultLocale","strings","dropHereOr","browse","defaultOpts","target","inputName","width","height","note","i18nInit","removeDragOverClassTimeout","onInputChange","bind","handleDragOver","handleDragLeave","handleDrop","addFiles","render","files","descriptors","map","file","source","name","data","meta","relativePath","err","log","event","value","onDrop","preventDefault","stopPropagation","clearTimeout","setPluginState","isDraggingOver","logDropError","error","dataTransfer","then","onDragOver","dropEffect","onDragLeave","setTimeout","renderHiddenFileInput","restrictions","ref","fileInputRef","maxNumberOfFiles","allowedFileTypes","renderArrowSvg","renderLabel","i18nArray","i18n","renderNote","dragDropClass","getPluginState","dragDropStyle","click","install","mount","uninstall","unmount","VERSION"],"mappings":"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","sourcesContent":["const { UIPlugin } = require('@uppy/core')\nconst toArray = require('@uppy/utils/lib/toArray')\nconst isDragDropSupported = require('@uppy/utils/lib/isDragDropSupported')\nconst getDroppedFiles = require('@uppy/utils/lib/getDroppedFiles')\nconst { h } = require('preact')\n\n/**\n * Drag & Drop plugin\n *\n */\nmodule.exports = class DragDrop extends UIPlugin {\n  // eslint-disable-next-line global-require\n  static VERSION = require('../package.json').version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DragDrop'\n    this.title = 'Drag & Drop'\n\n    this.defaultLocale = {\n      strings: {\n        dropHereOr: 'Drop files here or %{browse}',\n        browse: 'browse',\n      },\n    }\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n      inputName: 'files[]',\n      width: '100%',\n      height: '100%',\n      note: null,\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n\n    this.i18nInit()\n\n    // Check for browser dragDrop support\n    this.isDragDropSupported = isDragDropSupported()\n    this.removeDragOverClassTimeout = null\n\n    // Bind `this` to class methods\n    this.onInputChange = this.onInputChange.bind(this)\n    this.handleDragOver = this.handleDragOver.bind(this)\n    this.handleDragLeave = this.handleDragLeave.bind(this)\n    this.handleDrop = this.handleDrop.bind(this)\n    this.addFiles = this.addFiles.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n  addFiles (files) {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null,\n      },\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  onInputChange (event) {\n    this.uppy.log('[DragDrop] Files selected through input')\n    const files = toArray(event.target.files)\n    this.addFiles(files)\n\n    // We clear the input after a file is selected, because otherwise\n    // change event is not fired in Chrome and Safari when a file\n    // with the same name is selected.\n    // ___Why not use value=\"\" on <input/> instead?\n    //    Because if we use that method of clearing the input,\n    //    Chrome will not trigger change if we drop the same file twice (Issue #768).\n    // eslint-disable-next-line no-param-reassign\n    event.target.value = null\n  }\n\n  handleDrop (event) {\n    if (this.opts.onDrop) this.opts.onDrop(event)\n\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // 2. Remove dragover class\n    this.setPluginState({ isDraggingOver: false })\n\n    // 3. Add all dropped files\n    this.uppy.log('[DragDrop] Files were dropped')\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n    }\n    getDroppedFiles(event.dataTransfer, { logDropError })\n      .then((files) => this.addFiles(files))\n  }\n\n  handleDragOver (event) {\n    if (this.opts.onDragOver) this.opts.onDragOver(event)\n    event.preventDefault()\n    event.stopPropagation()\n\n    // 1. Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser\n    // https://github.com/transloadit/uppy/issues/1978)\n    //\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    this.setPluginState({ isDraggingOver: true })\n  }\n\n  handleDragLeave (event) {\n    if (this.opts.onDragLeave) this.opts.onDragLeave(event)\n    event.preventDefault()\n    event.stopPropagation()\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n  }\n\n  renderHiddenFileInput () {\n    const { restrictions } = this.uppy.opts\n    return (\n      <input\n        className=\"uppy-DragDrop-input\"\n        type=\"file\"\n        hidden\n        ref={(ref) => { this.fileInputRef = ref }}\n        name={this.opts.inputName}\n        multiple={restrictions.maxNumberOfFiles !== 1}\n        accept={restrictions.allowedFileTypes}\n        onChange={this.onInputChange}\n      />\n    )\n  }\n\n  static renderArrowSvg () {\n    return (\n      <svg aria-hidden=\"true\" focusable=\"false\" className=\"uppy-c-icon uppy-DragDrop-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\">\n        <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fillRule=\"evenodd\" />\n      </svg>\n    )\n  }\n\n  renderLabel () {\n    return (\n      <div className=\"uppy-DragDrop-label\">\n        {this.i18nArray('dropHereOr', {\n          browse: <span className=\"uppy-DragDrop-browse\">{this.i18n('browse')}</span>,\n        })}\n      </div>\n    )\n  }\n\n  renderNote () {\n    return (\n      <span className=\"uppy-DragDrop-note\">{this.opts.note}</span>\n    )\n  }\n\n  render () {\n    const dragDropClass = `uppy-Root\n      uppy-u-reset\n      uppy-DragDrop-container\n      ${this.isDragDropSupported ? 'uppy-DragDrop--isDragDropSupported' : ''}\n      ${this.getPluginState().isDraggingOver ? 'uppy-DragDrop--isDraggingOver' : ''}\n    `\n\n    const dragDropStyle = {\n      width: this.opts.width,\n      height: this.opts.height,\n    }\n\n    return (\n      <button\n        type=\"button\"\n        className={dragDropClass}\n        style={dragDropStyle}\n        onClick={() => this.fileInputRef.click()}\n        onDragOver={this.handleDragOver}\n        onDragLeave={this.handleDragLeave}\n        onDrop={this.handleDrop}\n      >\n        {this.renderHiddenFileInput()}\n        <div className=\"uppy-DragDrop-inner\">\n          {DragDrop.renderArrowSvg()}\n          {this.renderLabel()}\n          {this.renderNote()}\n        </div>\n      </button>\n    )\n  }\n\n  install () {\n    const { target } = this.opts\n\n    this.setPluginState({\n      isDraggingOver: false,\n    })\n\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"]}