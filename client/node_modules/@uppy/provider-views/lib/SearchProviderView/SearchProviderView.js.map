{"version":3,"sources":["SearchProviderView.js"],"names":["h","require","generateFileID","getFileType","isPreviewSupported","SearchInput","Browser","LoaderView","Header","SharedHandler","CloseWrapper","module","exports","ProviderView","constructor","plugin","opts","provider","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","search","bind","triggerSearchInput","addFile","preFirstRender","handleError","handleScroll","donePicking","cancelPicking","clearSelection","render","setPluginState","isInputMode","files","folders","directories","filterInput","isSearchVisible","tearDown","didFirstRender","onFirstRender","query","loaderWrapper","res","file","tagFile","id","providerFileToId","source","data","name","type","mimeType","isRemote","body","fileId","remote","companionUrl","url","fileUrl","requestPath","providerOptions","fileType","preview","thumbnail","uppy","log","err","isRestriction","error","toString","message","i18n","info","details","e","scrollPos","target","scrollHeight","scrollTop","offsetHeight","nextPageQuery","then","getPluginState","catch","currentSelection","promises","map","Promise","all","dashboard","getPlugin","hideAllPanels","state","viewOptions","loading","targetViewOptions","browserProps","isChecked","toggleCheckbox","done","cancel","headerComponent","title","pluginIcon","icon","uppyFiles","getFiles","validateRestrictions","args","VERSION","searchedFor","items","forEach","item","push"],"mappings":"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","sourcesContent":["const { h } = require('preact')\nconst generateFileID = require('@uppy/utils/lib/generateFileID')\nconst getFileType = require('@uppy/utils/lib/getFileType')\nconst isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported')\nconst SearchInput = require('./InputView')\nconst Browser = require('../Browser')\nconst LoaderView = require('../Loader')\nconst Header = require('./Header')\nconst SharedHandler = require('../SharedHandler')\nconst CloseWrapper = require('../CloseWrapper')\n\n/**\n * Class to easily generate generic views for Provider plugins\n */\nmodule.exports = class ProviderView {\n  static VERSION = require('../../package.json').version\n\n  #isHandlingScroll\n\n  #searchTerm\n\n  #sharedHandler\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    this.plugin = plugin\n    this.provider = opts.provider\n    this.#sharedHandler = new SharedHandler(plugin)\n\n    // set default options\n    const defaultOptions = {\n      viewType: 'grid',\n      showTitles: false,\n      showFilter: false,\n      showBreadcrumbs: false,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.search = this.search.bind(this)\n    this.triggerSearchInput = this.triggerSearchInput.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.preFirstRender = this.preFirstRender.bind(this)\n    this.handleError = this.handleError.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n    this.cancelPicking = this.cancelPicking.bind(this)\n    this.clearSelection = this.clearSelection.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    this.clearSelection()\n\n    // Set default state for the plugin\n    this.plugin.setPluginState({\n      isInputMode: true,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      isSearchVisible: false,\n    })\n  }\n\n  tearDown () {\n    // Nothing.\n  }\n\n  #updateFilesAndInputMode (res, files) {\n    this.nextPageQuery = res.nextPageQuery\n    this.#searchTerm = res.searchedFor\n    res.items.forEach((item) => { files.push(item) })\n    this.plugin.setPluginState({ isInputMode: false, files })\n  }\n\n  /**\n   * Called only the first time the provider view is rendered.\n   * Kind of like an init function.\n   */\n  preFirstRender () {\n    this.plugin.setPluginState({ didFirstRender: true })\n    this.plugin.onFirstRender()\n  }\n\n  search (query) {\n    if (query && query === this.#searchTerm) {\n      // no need to search again as this is the same as the previous search\n      this.plugin.setPluginState({ isInputMode: false })\n      return\n    }\n\n    return this.#sharedHandler.loaderWrapper(\n      this.provider.search(query),\n      (res) => {\n        this.#updateFilesAndInputMode(res, [])\n      },\n      this.handleError\n    )\n  }\n\n  triggerSearchInput () {\n    this.plugin.setPluginState({ isInputMode: true })\n  }\n\n  // @todo this function should really be a function of the plugin and not the view.\n  // maybe we should consider creating a base ProviderPlugin class that has this method\n  addFile (file) {\n    const tagFile = {\n      id: this.providerFileToId(file),\n      source: this.plugin.id,\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n      isRemote: true,\n      body: {\n        fileId: file.id,\n      },\n      remote: {\n        companionUrl: this.plugin.opts.companionUrl,\n        url: `${this.provider.fileUrl(file.requestPath)}`,\n        body: {\n          fileId: file.id,\n        },\n        providerOptions: { ...this.provider.opts, provider: null },\n      },\n    }\n\n    const fileType = getFileType(tagFile)\n    // TODO Should we just always use the thumbnail URL if it exists?\n    if (fileType && isPreviewSupported(fileType)) {\n      tagFile.preview = file.thumbnail\n    }\n    this.plugin.uppy.log('Adding remote file')\n    try {\n      this.plugin.uppy.addFile(tagFile)\n    } catch (err) {\n      if (!err.isRestriction) {\n        this.plugin.uppy.log(err)\n      }\n    }\n  }\n\n  providerFileToId (file) {\n    return generateFileID({\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n    })\n  }\n\n  handleError (error) {\n    const { uppy } = this.plugin\n    uppy.log(error.toString())\n    const message = uppy.i18n('companionError')\n    uppy.info({ message, details: error.toString() }, 'error', 5000)\n  }\n\n  handleScroll (e) {\n    const scrollPos = e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight)\n    const query = this.nextPageQuery || null\n\n    if (scrollPos < 50 && query && !this.#isHandlingScroll) {\n      this.provider.search(this.#searchTerm, query)\n        .then((res) => {\n          const { files } = this.plugin.getPluginState()\n          this.#updateFilesAndInputMode(res, files)\n        }).catch(this.handleError)\n        .then(() => { this.#isHandlingScroll = false }) // always called\n\n      this.#isHandlingScroll = true\n    }\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    const promises = currentSelection.map((file) => this.addFile(file))\n\n    this.#sharedHandler.loaderWrapper(Promise.all(promises), () => {\n      this.clearSelection()\n    }, () => {})\n  }\n\n  cancelPicking () {\n    this.clearSelection()\n\n    const dashboard = this.plugin.uppy.getPlugin('Dashboard')\n    if (dashboard) dashboard.hideAllPanels()\n  }\n\n  clearSelection () {\n    this.plugin.setPluginState({ currentSelection: [] })\n  }\n\n  render (state, viewOptions = {}) {\n    const { didFirstRender, isInputMode } = this.plugin.getPluginState()\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    // reload pluginState for \"loading\" attribute because it might\n    // have changed above.\n    if (this.plugin.getPluginState().loading) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <LoaderView i18n={this.plugin.uppy.i18n} />\n        </CloseWrapper>\n      )\n    }\n\n    if (isInputMode) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <SearchInput\n            search={this.search}\n            i18n={this.plugin.uppy.i18n}\n          />\n        </CloseWrapper>\n      )\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const browserProps = {\n      ...this.plugin.getPluginState(),\n      isChecked: this.#sharedHandler.isChecked,\n      toggleCheckbox: this.#sharedHandler.toggleCheckbox,\n      handleScroll: this.handleScroll,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header({\n        triggerSearchInput: this.triggerSearchInput,\n        i18n: this.plugin.uppy.i18n,\n      }),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: (...args) => this.plugin.uppy.validateRestrictions(...args),\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.clearSelection}>\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"]}